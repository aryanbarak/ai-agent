# ğŸ—ï¸ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù…Ø¹Ù…Ø§Ø±ÛŒ: Ù‚Ø¨Ù„ Ùˆ Ø¨Ø¹Ø¯ Ø§Ø² Refactoring

## âŒ Ù…Ø¹Ù…Ø§Ø±ÛŒ ÙØ¹Ù„ÛŒ (Ù‚Ø¨Ù„)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLI (main.py)                       â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ handle_  â”‚  â”‚ handle_  â”‚  â”‚ handle_  â”‚             â”‚
â”‚  â”‚  fiae    â”‚  â”‚ planner  â”‚  â”‚ career   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚             â”‚             â”‚
         â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  API Layer (api.py)                    â”‚
â”‚                     598 LINES!                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âŒ HTTP Routes                                   â”‚ â”‚
â”‚  â”‚ âŒ Business Logic (compute_importance_urgency)   â”‚ â”‚
â”‚  â”‚ âŒ Data Processing (build_day_schedule)          â”‚ â”‚
â”‚  â”‚ âŒ Hardcoded Knowledge (_get_pseudocode_block)   â”‚ â”‚
â”‚  â”‚ âŒ Validation                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Direct Calls
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Modules (Business Logic)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ fiaetutor.py   â”‚  â”‚ planner.py     â”‚                â”‚
â”‚  â”‚  399 LINES!    â”‚  â”‚                â”‚                â”‚
â”‚  â”‚                â”‚  â”‚                â”‚                â”‚
â”‚  â”‚ âŒ LLM Client  â”‚  â”‚ âœ… Clean       â”‚                â”‚
â”‚  â”‚ âŒ Caching     â”‚  â”‚ âœ… Simple      â”‚                â”‚
â”‚  â”‚ âŒ Parsing     â”‚  â”‚                â”‚                â”‚
â”‚  â”‚ âŒ Prompts     â”‚  â”‚                â”‚                â”‚
â”‚  â”‚ âŒ Validation  â”‚  â”‚                â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚          â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ fiae_analysis.py   career.py â”‚                      â”‚
â”‚  â”‚  (reuse same client)         â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Global Variable
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Global State (Problems!)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ client = OpenAI(...)  âŒ Global, Hardcoded       â”‚  â”‚
â”‚  â”‚ _CACHE = {}           âŒ Unbounded, Thread-unsafe â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Direct Calls
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Data Layer                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ memory.py                                        â”‚  â”‚
â”‚  â”‚  âœ… Simple SQLite operations                     â”‚  â”‚
â”‚  â”‚  âŒ Sync only                                    â”‚  â”‚
â”‚  â”‚  âŒ No connection pooling                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”´ Ù…Ø´Ú©Ù„Ø§Øª Ù…Ø¹Ù…Ø§Ø±ÛŒ ÙØ¹Ù„ÛŒ:

1. **God Classes**
   - `api.py`: 598 Ø®Ø· - Ù…Ø³Ø¦ÙˆÙ„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…ØªØ¹Ø¯Ø¯
   - `fiaetutor.py`: 399 Ø®Ø· - Ù‡Ù…Ù‡ Ú†ÛŒØ² Ø¯Ø± ÛŒÚ© Ø¬Ø§

2. **Global State**
   - `client` Ùˆ `_CACHE` global Ù‡Ø³ØªÙ†Ø¯
   - Thread-unsafe
   - ØªØ³Øª Ù†ÙˆÛŒØ³ÛŒ ØºÛŒØ±Ù…Ù…Ú©Ù†

3. **Tight Coupling**
   - Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø¨Ù‡ Ù‡Ù… ÙˆØ§Ø¨Ø³ØªÙ‡â€ŒØ§Ù†Ø¯
   - ØªØºÛŒÛŒØ± ÛŒÚ©ÛŒ Ù‡Ù…Ù‡ Ø±Ø§ Ù…ÛŒâ€ŒØ´Ú©Ù†Ø¯

4. **Mixed Concerns**
   - Ù…Ù†Ø·Ù‚ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø± Ø¯Ø± API layer
   - Infrastructure Ø¯Ø± Business layer

---

## âœ… Ù…Ø¹Ù…Ø§Ø±ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ (Ø¨Ø¹Ø¯ - Clean Architecture)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   FastAPI Routes     â”‚    â”‚   CLI Interface      â”‚          â”‚
â”‚  â”‚  (refactored_api.py) â”‚    â”‚    (main_v2.py)      â”‚          â”‚
â”‚  â”‚                      â”‚    â”‚                      â”‚          â”‚
â”‚  â”‚  @app.post("/api/    â”‚    â”‚  def handle_fiae():  â”‚          â”‚
â”‚  â”‚    fiae/analyze")    â”‚    â”‚    service.analyze() â”‚          â”‚
â”‚  â”‚  async def analyze   â”‚    â”‚                      â”‚          â”‚
â”‚  â”‚    (req, container): â”‚    â”‚                      â”‚          â”‚
â”‚  â”‚    âœ… Only routing   â”‚    â”‚  âœ… Only UI logic    â”‚          â”‚
â”‚  â”‚    âœ… No business    â”‚    â”‚                      â”‚          â”‚
â”‚  â”‚       logic          â”‚    â”‚                      â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                              â”‚
              â”‚ Depends on (DI)              â”‚
              â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Application Layer                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Services                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ FIAEAnalysis   â”‚  â”‚ PlannerService â”‚  â”‚ Career    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ Service        â”‚  â”‚                â”‚  â”‚ Service   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                â”‚  â”‚                â”‚  â”‚           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ âœ… Business    â”‚  â”‚ âœ… Business    â”‚  â”‚ âœ…        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    logic only  â”‚  â”‚    logic only  â”‚  â”‚   Businessâ”‚  â”‚  â”‚
â”‚  â”‚  â”‚ âœ… Orchestrate â”‚  â”‚ âœ… Eisenhower  â”‚  â”‚   logic   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    dependenciesâ”‚  â”‚    Matrix      â”‚  â”‚           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ âœ… No infra    â”‚  â”‚                â”‚  â”‚           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    details     â”‚  â”‚                â”‚  â”‚           â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Depends on Protocols (Interfaces)
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Domain Layer                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               Protocols (Interfaces)                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ LLMProviderâ”‚  â”‚ Cache      â”‚  â”‚ FIAERepository    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ Protocol   â”‚  â”‚ Provider   â”‚  â”‚ Protocol          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚            â”‚  â”‚ Protocol   â”‚  â”‚                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ async def  â”‚  â”‚            â”‚  â”‚ async def save()  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ complete() â”‚  â”‚ async def  â”‚  â”‚ async def get()   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚            â”‚  â”‚ get()      â”‚  â”‚                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚            â”‚  â”‚ set()      â”‚  â”‚                   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  âœ… Define contracts (what, not how)                    â”‚  â”‚
â”‚  â”‚  âœ… No implementation details                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               Domain Models                              â”‚  â”‚
â”‚  â”‚  @dataclass                                              â”‚  â”‚
â”‚  â”‚  class FIAELog:                                          â”‚  â”‚
â”‚  â”‚      id: int | None                                      â”‚  â”‚
â”‚  â”‚      created_at: str                                     â”‚  â”‚
â”‚  â”‚      problem: str                                        â”‚  â”‚
â”‚  â”‚      answer: str                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Implemented by
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Infrastructure Layer                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    LLM Providers                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ Gemini       â”‚  â”‚ OpenAI       â”‚  â”‚ Claude       â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ Provider     â”‚  â”‚ Provider     â”‚  â”‚ Provider     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ implements   â”‚  â”‚ implements   â”‚  â”‚ implements   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ LLMProvider  â”‚  â”‚ LLMProvider  â”‚  â”‚ LLMProvider  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ âœ… Async     â”‚  â”‚ âœ… Async     â”‚  â”‚ âœ… Async     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ âœ… Retry     â”‚  â”‚ âœ… Retry     â”‚  â”‚ âœ… Retry     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ âœ… Circuit   â”‚  â”‚ âœ… Circuit   â”‚  â”‚ âœ… Circuit   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚    Breaker   â”‚  â”‚    Breaker   â”‚  â”‚    Breaker   â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Caching                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚  â”‚
â”‚  â”‚  â”‚ LRU Cache    â”‚  â”‚ Redis Cache  â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚              â”‚  â”‚  (future)    â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚ implements   â”‚  â”‚              â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚ CacheProviderâ”‚  â”‚ implements   â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚              â”‚  â”‚ CacheProviderâ”‚                     â”‚  â”‚
â”‚  â”‚  â”‚ âœ… Thread-   â”‚  â”‚              â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚    safe      â”‚  â”‚ âœ… Distributed                     â”‚  â”‚
â”‚  â”‚  â”‚ âœ… TTL       â”‚  â”‚                                     â”‚  â”‚
â”‚  â”‚  â”‚ âœ… Size limitâ”‚  â”‚                                     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Database                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚  â”‚
â”‚  â”‚  â”‚ SQLite       â”‚  â”‚ PostgreSQL   â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚ Repository   â”‚  â”‚ Repository   â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚              â”‚  â”‚  (future)    â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚ implements   â”‚  â”‚              â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚ FIAERepositoryâ”‚  â”‚ implements  â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚              â”‚  â”‚ FIAERepository                     â”‚  â”‚
â”‚  â”‚  â”‚ âœ… Async     â”‚  â”‚              â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚ âœ… Safe      â”‚  â”‚ âœ… Scalable  â”‚                     â”‚  â”‚
â”‚  â”‚  â”‚    queries   â”‚  â”‚                                     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### âœ… Ù…Ø²Ø§ÛŒØ§ÛŒ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø¬Ø¯ÛŒØ¯:

1. **Clear Separation of Concerns**
   - Ù‡Ø± Ù„Ø§ÛŒÙ‡ Ù…Ø³Ø¦ÙˆÙ„ÛŒØª Ù…Ø´Ø®Øµ Ø¯Ø§Ø±Ø¯
   - ØªØºÛŒÛŒØ±Ø§Øª local Ù‡Ø³ØªÙ†Ø¯

2. **Dependency Injection**
   - ØªØ³Øª Ù†ÙˆÛŒØ³ÛŒ Ø¢Ø³Ø§Ù†
   - Mock Ú©Ø±Ø¯Ù† Ø³Ø§Ø¯Ù‡
   - Loose coupling

3. **Pluggable Components**
   - ØªØ¹ÙˆÛŒØ¶ LLM provider Ø¢Ø³Ø§Ù†
   - ØªØ¹ÙˆÛŒØ¶ cache backend Ø¢Ø³Ø§Ù†
   - ØªØ¹ÙˆÛŒØ¶ database Ø¢Ø³Ø§Ù†

4. **SOLID Principles**
   - Single Responsibility âœ…
   - Open/Closed âœ…
   - Liskov Substitution âœ…
   - Interface Segregation âœ…
   - Dependency Inversion âœ…

---

## ğŸ”„ Ø¬Ø±ÛŒØ§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øª (Request Flow)

### âŒ Ù‚Ø¨Ù„:

```
User Request
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  api.py        â”‚  âŒ Ù‡Ù…Ù‡ Ú†ÛŒØ² Ø¯Ø± ÛŒÚ© Ø¬Ø§
â”‚  - Routing     â”‚
â”‚  - Validation  â”‚
â”‚  - Logic       â”‚
â”‚  - Processing  â”‚
â”‚  - DB Call     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
    Response
```

### âœ… Ø¨Ø¹Ø¯:

```
User Request
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Route      â”‚  âœ… ÙÙ‚Ø· routing
â”‚ (Presentation) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ inject dependencies
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service        â”‚  âœ… ÙÙ‚Ø· business logic
â”‚ (Application)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ use protocols
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLM Provider   â”‚  âœ… ÙÙ‚Ø· LLM calls
â”‚ (Infrastructure)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cache          â”‚  âœ… ÙÙ‚Ø· caching
â”‚ (Infrastructure)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Repository     â”‚  âœ… ÙÙ‚Ø· data access
â”‚ (Infrastructure)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
    Response
```

---

## ğŸ“Š Ù…Ù‚Ø§ÛŒØ³Ù‡ Ú©Ø¯Ù‡Ø§

### Ù…Ø«Ø§Ù„ 1: Analyze FIAE Problem

#### âŒ Ù‚Ø¨Ù„ (fiaetutor.py):
```python
# 399 Ø®Ø· Ø¯Ø± ÛŒÚ© ÙØ§ÛŒÙ„!

client = OpenAI(...)  # âŒ Global
_CACHE = {}  # âŒ Thread-unsafe

def analyze_problem(problem_text, lang=None):
    # âŒ Validation
    # âŒ Caching
    # âŒ API Call
    # âŒ Parsing
    # âŒ Language Check
    # âŒ Retry Logic
    # âŒ Error Handling
    # Ù‡Ù…Ù‡ Ø¯Ø± ÛŒÚ© ØªØ§Ø¨Ø¹!
    ...
```

#### âœ… Ø¨Ø¹Ø¯ (Clean separation):

```python
# protocols.py (Interface)
class LLMProvider(Protocol):
    async def complete(self, ...): ...

# gemini.py (Implementation)
class GeminiProvider:
    async def complete(self, ...):
        # âœ… ÙÙ‚Ø· LLM call
        ...

# cache.py (Implementation)
class LRUCache:
    async def get(self, ...):
        # âœ… ÙÙ‚Ø· caching
        ...

# fiae_service.py (Business Logic)
class FIAEAnalysisService:
    def __init__(self, llm, cache, repo):
        # âœ… Dependency Injection
        self.llm = llm
        self.cache = cache
        self.repo = repo
    
    async def analyze(self, text):
        # âœ… ÙÙ‚Ø· orchestration
        # âœ… Clean business logic
        ...
```

---

## ğŸ§ª ØªØ³Øªâ€ŒÙ¾Ø°ÛŒØ±ÛŒ

### âŒ Ù‚Ø¨Ù„ (ØºÛŒØ±Ù…Ù…Ú©Ù†):

```python
# Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù† ØªØ³Øª Ù†ÙˆØ´Øª Ú†ÙˆÙ†:
# - client global Ø§Ø³Øª
# - Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø¨Ù‡ API ÙˆØ§Ø¨Ø³ØªÙ‡ Ø§Ø³Øª
# - sync Ø§Ø³Øª
# - cache global Ø§Ø³Øª
```

### âœ… Ø¨Ø¹Ø¯ (Ø¢Ø³Ø§Ù†):

```python
@pytest.mark.asyncio
async def test_analyze_problem():
    # âœ… Mock dependencies
    mock_llm = MockLLMProvider()
    mock_cache = MockCache()
    mock_repo = MockRepository()
    
    # âœ… Inject mocks
    service = FIAEAnalysisService(
        llm=mock_llm,
        cache=mock_cache,
        repo=mock_repo,
    )
    
    # âœ… Test in isolation
    result = await service.analyze("test problem")
    assert result["summary"]
```

---

## ğŸ“ˆ Ù†ØªÛŒØ¬Ù‡â€ŒÚ¯ÛŒØ±ÛŒ

| Ø¬Ù†Ø¨Ù‡ | Ù‚Ø¨Ù„ | Ø¨Ø¹Ø¯ |
|------|-----|-----|
| **Modularity** | âŒ God Classes | âœ… Single Responsibility |
| **Coupling** | âŒ Tight | âœ… Loose |
| **Testability** | âŒ Hard | âœ… Easy |
| **Scalability** | âŒ Limited | âœ… Excellent |
| **Maintainability** | âŒ Difficult | âœ… Simple |
| **Performance** | âŒ Sync/Blocking | âœ… Async/Non-blocking |
| **Type Safety** | âš ï¸ Partial | âœ… Full |

**Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø¬Ø¯ÛŒØ¯ Ù¾Ø±ÙˆÚ˜Ù‡ Ø±Ø§ Ø§Ø² MVP Ø¨Ù‡ Production-Ready ØªØ¨Ø¯ÛŒÙ„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯!** ğŸš€
